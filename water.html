<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthTracker - Water Intake</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    
<body>

<nav class="side-nav">
    <h2><i class="fas fa-heartbeat"></i> HealthTracker</h2>
    <div class="nav-links">
        <a href="dashboard.html"><i class="fas fa-th-large"></i> <span>Dashboard</span></a>
        <a href="steps.html"><i class="fas fa-running"></i> <span>Daily Steps</span></a>
        <a href="water.html"><i class="fas fa-tint"></i> <span>Water Intake</span></a>
        <a href="coming_soon.html#sleep"><i class="fas fa-moon"></i> <span>Sleep Tracker</span></a>
        <a href="coming_soon.html#weight"><i class="fas fa-weight"></i> <span>Weight Management</span></a>
        <a href="coming_soon.html#medicines"><i class="fas fa-pills"></i> <span>Your Medicines</span></a>
        <a href="coming_soon.html#appointments"><i class="fas fa-calendar-check"></i> <span>Medical Appointments</span></a>
    </div>
</nav>

<div class="wrapper">
    <header class="top-nav">
        <h1 id="pageTitle">Water Intake</h1>
        <div class="user-profile">
            <span id="topWelcome"></span>
            <button id="logoutBtn">Logout</button>
        </div>
    </header>

        <main class="main-content" style="padding: 30px;">
            <div class="card">
                <div class="goal-display">
                    <p>Your Calculated Daily Need</p>
                    <div class="goal-number" id="waterGoalDisplay">--</div>
                    <p>Liters</p>
                </div>

                <div class="entry-form">
                    <input type="number" step="0.1" id="waterInput" placeholder="Liters (e.g. 0.5)">
                    <button class="btn-log" onclick="logWater()">Add Water</button>
                </div>
                <div class="encouragement" id="waterMsg">"Stay hydrated for peak performance!"</div>
            </div>

            <div class="health-note" id="waterAdvisory">
                <h4><i class="fas fa-lightbulb"></i> Personalized Hydration Advice</h4>
                <div id="waterAdviceContent">Loading your profile-based suggestions...</div>
            </div>
        </main>
    </div>

    <script src="js/common.js"></script>
    <script>
        function logWater() {
            const input = document.getElementById('waterInput');
            const msg = document.getElementById('waterMsg');
            const water = parseFloat(input.value);
            
            if (isNaN(water) || water <= 0) {
                msg.textContent = "Please enter a valid amount of water.";
                msg.style.color = "#ff7675";
                return;
            }
            
            // Get current water from localStorage
            const today = new Date().toISOString().split('T')[0];
            const waterKey = `water_${userEmail}_${today}`;
            const currentWater = parseFloat(localStorage.getItem(waterKey) || 0);
            const newTotal = currentWater + water;
            
            // Save to localStorage
            localStorage.setItem(waterKey, newTotal.toFixed(1));
            
            // Update message
            msg.textContent = `Added ${water}L! Total today: ${newTotal.toFixed(1)}L. Great job staying hydrated! ðŸ’§`;
            msg.style.color = "var(--primary)";
            
            // Clear input
            input.value = "";
        }

        function initWater() {
        const profile = JSON.parse(localStorage.getItem(`profile_${userEmail}`)) || {};
        if (profile.weight) {
            const goal = (profile.weight * 0.033).toFixed(1);
            document.getElementById('waterGoalDisplay').textContent = goal;
            
            let advice = `Based on your weight of ${profile.weight}kg: <br><ul>`;
            advice += `<li>Your baseline is ${goal}L, but add 500ml for every 30 mins of exercise.</li>`;
            if(profile.gender === "Male") advice += "<li>Men typically have higher muscle mass and require 10% more water than average.</li>";
            advice += "<li>Try the '8x8' rule: 8 glasses of 250ml throughout the day.</li></ul>";
            document.getElementById('waterAdviceContent').innerHTML = advice;
        }
    }

    // Set active sidebar link based on current page
    document.addEventListener('DOMContentLoaded', function() {
        const currentPage = window.location.pathname.split('/').pop();
        const navLinks = document.querySelectorAll('.nav-links a');
        
        // Remove active class from all links
        navLinks.forEach(link => link.classList.remove('active'));
        
        // Add active class to the link matching current page
        navLinks.forEach(link => {
            if (link.getAttribute('href') === currentPage) {
                link.classList.add('active');
            }
        });
    });

    initWater();
</script>
</body>
</html>